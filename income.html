<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Income</title>
    <link rel="stylesheet" href="output.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <!-- table styling -->
    <style>
      table {
        border-collapse: collapse;
        width: 100%;
      }
      th,
      td {
        border: 1px solid #dddddd;
        text-align: center;
        padding: 8px;
        color: white;
      }
      @media screen and (max-width: 400px) {
        td {
          padding: 1px;
        }
      }
      th {
        background-color: #f2f2f2;
        color: black;
      }
    </style>
  </head>
  <body class="bg-[#404040] font-Source Sans Pro, sans-serif text-slate-100">
    <header class="bg-[#2b2b2b] sticky top-0 md:h-[110px]">
      <div
        class="text-slate-100 p-3 md:p-6 lg:px-20 bg-[#2b2b2b] flex justify-between items-center"
      >
        <div class="flex items-center gap-3">
          <div id="toggle" class="md:hidden cursor-pointer">
            <span class="material-symbols-outlined"> menu </span>
          </div>
          <div>
            <p class="md:text-lg lg:text-2xl font-bold">
              EXPENSE <span class="text-[#51d289] ml-1">BOOK</span>
            </p>
            <p class="text-xs">Track, save, conquer.</p>
          </div>
        </div>
        <div class="flex gap-4 items-center">
          <img class="w-8 rounded-full" src="assets/profile pic.png" alt="" />
          <div>
            <p id="user-name" class="md:text-lg">Your Name</p>
          </div>
        </div>
      </div>
      <hr class="mx-5 pb-4" />
    </header>
    <div class="w-full flex h-[calc(100%-110px)] bg-[#404040]">
      <!-- sidebar -->
      <aside
        class="md:flex md:flex-col h-[calc(100vh-110px)] pl-5 justify-between hidden bg-[#2b2b2b] w-[200px] text-slate-100 text-base font-bold py-10 gap-8 fixed top-[110px]"
      >
        <div class="flex flex-col gap-7">
          <a
            href="home.html"
            class="flex gap-3 cursor-pointer items-center hover:text-[#51d289] hover:bg-[#404040] p-2 rounded-md mr-1"
          >
            <span class="material-symbols-outlined"> dashboard </span>
            <span>Dashboard</span></a
          >

          <a
            href="income.html"
            class="flex gap-3 cursor-pointer items-center hover:text-[#51d289] hover:bg-[#404040] p-2 rounded-md mr-1"
          >
            <span class="material-symbols-outlined"> savings </span>

            <span>Income</span></a
          >

          <a
            href="expense.html"
            class="flex gap-3 cursor-pointer items-center hover:text-[#51d289] hover:bg-[#404040] p-2 rounded-md mr-1"
          >
            <span class="material-symbols-outlined"> payments </span>
            <span>Expenses</span></a
          >

          <a
            href="categories.html"
            class="flex gap-3 cursor-pointer items-center hover:text-[#51d289] hover:bg-[#404040] p-2 rounded-md mr-1"
          >
            <span class="material-symbols-outlined"> calculate </span>
            <span>Categories</span></a
          >

          <a
            href="setting.html"
            class="flex gap-3 cursor-pointer items-center hover:text-[#51d289] hover:bg-[#404040] p-2 rounded-md mr-1"
          >
            <span class="material-symbols-outlined"> settings </span>
            <span>Setting</span></a
          >
        </div>
        <div class="flex flex-col gap-5">
          <a
            href="profile.html"
            class="flex gap-3 cursor-pointer items-center hover:text-[#51d289] hover:bg-[#404040] p-2 rounded-md mr-1"
          >
            <span class="material-symbols-outlined"> person </span>
            <span>Profile</span></a
          >

          <div
            onclick="logout()"
            class="flex gap-3 items-center cursor-pointer hover:text-[#51d289] hover:bg-[#404040] p-2 rounded-md mr-1"
          >
            <span class="material-symbols-outlined"> logout </span>
            <span>Logout</span>
          </div>
        </div>
      </aside>
      <!-- mob sidebar -->
      <aside
        id="mob-sidebar"
        class="pl-5 flex-col hidden h-[calc(100vh-110px)] justify-between md:hidden bg-[#2b2b2b] w-[200px] absolute text-slate-100 text-base font-bold py-10 gap-8"
      >
        <div class="flex flex-col gap-7">
          <a
            href="home.html"
            class="flex gap-3 cursor-pointer items-center hover:text-[#51d289] hover:bg-[#404040] p-2 rounded-md mr-1"
          >
            <span class="material-symbols-outlined"> dashboard </span>
            <span>Dashboard</span></a
          >

          <a
            href="income.html"
            class="flex gap-3 cursor-pointer items-center hover:text-[#51d289] hover:bg-[#404040] p-2 rounded-md mr-1"
          >
            <span class="material-symbols-outlined"> savings </span>

            <span>Income</span></a
          >

          <a
            href="expense.html"
            class="flex gap-3 cursor-pointer items-center hover:text-[#51d289] hover:bg-[#404040] p-2 rounded-md mr-1"
          >
            <span class="material-symbols-outlined"> payments </span>
            <span>Expenses</span></a
          >

          <a
            href="categories.html"
            class="flex gap-3 cursor-pointer items-center hover:text-[#51d289] hover:bg-[#404040] p-2 rounded-md mr-1"
          >
            <span class="material-symbols-outlined"> calculate </span>
            <span>Categories</span></a
          >

          <a
            href="setting.html"
            class="flex gap-3 cursor-pointer items-center hover:text-[#51d289] hover:bg-[#404040] p-2 rounded-md mr-1"
          >
            <span class="material-symbols-outlined"> settings </span>
            <span>Setting</span></a
          >
        </div>
        <div class="flex flex-col gap-5">
          <a
            href="profile.html"
            class="flex gap-3 cursor-pointer items-center hover:text-[#51d289] hover:bg-[#404040] p-2 rounded-md mr-1"
          >
            <span class="material-symbols-outlined"> person </span>
            <span>Profile</span></a
          >

          <div
            onclick="logout()"
            class="flex gap-3 items-center cursor-pointer hover:text-[#51d289] hover:bg-[#404040] p-2 rounded-md mr-1"
          >
            <span class="material-symbols-outlined"> logout </span>
            <span>Logout</span>
          </div>
        </div>
      </aside>
      <section class="flex flex-col md:ml-[100px] items-center w-full gap-14">
        <div class="flex flex-col mt-10 ml-3 mr-2 gap-7">
          <p class="self-center text-xl md:text-2xl font-bold">Income</p>
          <input
            type="number"
            id="txtincome-input"
            class="bg-gray-100 border-2 border-gray-300 md:w-[400px] w-[200px] rounded-md text-black p-2.5 focus:border-2 focus:border-black text-center"
            placeholder="Add Income"
            required
          />

          <select
            id="selectValue-income"
            name="selectValue"
            class="border-2 border-gray-300 rounded-md md:w-[400px] text-black w-[200px] p-2.5 focus:border-2 focus:border-black text-center"
          >
            <option>Salary</option>
            <option>Bonus</option>
            <option>Commission</option>
            <option>Gift</option>
            <option>Others</option>
          </select>

          <input
            type="date"
            id="income-date-input"
            class="bg-gray-100 border-2 border-gray-300 md:w-[400px] rounded-md w-[200px] text-black p-2.5 focus:border-2 focus:border-black text-center"
            placeholder=""
            required
          />
          <input
            type="text"
            id="income-note-input"
            class="bg-gray-100 border-2 border-gray-300 md:w-[400px] rounded-md w-[200px] text-black p-2.5 focus:border-2 focus:border-black text-center"
            placeholder="Add Note"
            required
          />

          <button
            id="save-income"
            class="border p-2 rounded-md w-[120px] self-center text-black mt-6 bg-[#51d289] hover:bg-[#1f9e56] hover:text-slate-100"
          >
            Save
          </button>
        </div>
        <div
          class="p-2 bg-[#2b2b2b] rounded-md mb-10 md:w-[400px] lg:w-[700px]"
        >
          <table id="dataTableIncome" class="table-auto border-collapse border">
            <thead>
              <tr>
                <th class="border p-1">Type</th>
                <th class="border p-1">Amount</th>
                <th class="border p-1">Category</th>
                <th class="border p-1">Date</th>
                <th class="border p-1">Note</th>

                <th class="border p-1">Delete</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </div>

    <!-- Javascript -->
    <script src="script.js"></script>
    <script>
      const $txtincomeInpute = document.getElementById("txtincome-input");
      const $incomeSelect = document.getElementById("selectValue-income");
      const $incomeDate = document.getElementById("income-date-input");
      const $incomeNote = document.getElementById("income-note-input");
      const $saveIncome = document.getElementById("save-income");

      const currentDate = new Date().toISOString().split("T")[0];

      document.getElementById("income-date-input").value = currentDate;

      let incomeData = [];

      function handleSubmitIncome() {
        const money = $txtincomeInpute.value;
        const source = $incomeSelect.value;
        const date = $incomeDate.value;
        const note = $incomeNote.value;

        if (!money) {
          alert("Put Your Income");
          return;
        }
        if (!date) {
          alert("Add Date");
          return;
        }
        if (!note) {
          alert("Add Note");
          return;
        }

        const userData = {
          money,
          source,
          date,
          note,
          type: "Income",
          delete: "Delete",
        };

        const users = JSON.parse(localStorage.getItem("users")) || [];

        // Find the current user in the array
        const currentUserObject = users.find(
          (user) => user.email === activeuser
        );

        // Create a child array 'userData' if not present, and add new data to it
        if (currentUserObject && !currentUserObject.userData) {
          currentUserObject.userData = [];
        }
        currentUserObject.userData.push(userData);

        // Save the updated array back to local storage
        localStorage.setItem("users", JSON.stringify(users));

        displayDataIncome();
        cleanupSlate();
      }

      function cleanupSlate() {
        $txtincomeInpute.value = "";
        $incomeSelect.value = "Salary";
        $incomeDate.value = currentDate;
        $incomeNote.value = "";
      }

      // displaying data in table

      $saveIncome.addEventListener("click", handleSubmitIncome);

      function displayDataIncome() {
        const users = JSON.parse(localStorage.getItem("users")) || [];

        // Find the current user in the array
        const currentUserObject = users.find(
          (user) => user.email === activeuser
        );

        const userData =
          currentUserObject && currentUserObject.userData
            ? currentUserObject.userData
            : [];

        const tableBody = document.querySelector("#dataTableIncome tbody");

        tableBody.innerHTML = "";

        userData.forEach((data, index) => {
          if (data.type === "Income") {
            const row = tableBody.insertRow();
            const cell1 = row.insertCell(0);
            const cell2 = row.insertCell(1);
            const cell3 = row.insertCell(2);
            const cell4 = row.insertCell(3);
            const cell5 = row.insertCell(4);
            const cell6 = row.insertCell(5);

            cell1.textContent = data.type;
            cell2.textContent = data.money;
            cell3.textContent = data.source;
            cell4.textContent = data.date;
            cell5.textContent = data.note;

            const deleteLink = document.createElement("a");
            deleteLink.href = "#";
            deleteLink.textContent = "Delete";
            deleteLink.onclick = function () {
              deleteRow(index);
            };

            cell6.appendChild(deleteLink);
          }
        });
      }

      function deleteRow(index) {
        // Get current user from the hidden input

        // Retrieve users from local storage
        const users = JSON.parse(localStorage.getItem("users")) || [];

        // Find the current user in the array
        const currentUserObject = users.find(
          (user) => user.email === activeuser
        );

        // Check if userData exists for the current user
        const userData =
          currentUserObject && currentUserObject.userData
            ? currentUserObject.userData
            : [];

        // Remove the selected row from userData
        userData.splice(index, 1);

        // Update the array back to local storage
        localStorage.setItem("users", JSON.stringify(users));

        // Display the updated data in the table
        displayDataIncome();
      }

      displayDataIncome();
      populateSelect();
    </script>
  </body>
</html>
